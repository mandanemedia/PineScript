//@version=2
strategy("Higher TF Price Differential - Dan", shorttitle="HigherTFPriceDifferential", overlay=false)

Hourly=input(4, title="Hourly Higher Time frame", type=integer)
thresholdLimit = input(title="Threshold Limit", type=float, defval=0.6, step=0.2)

//This is to get the price differential
//between previous 4 hours candle (defualt 4 hours) and current 4 hours candle
//resolving the closing price of 4 hour candle is fluctuating, hence in reality this does not work.
getDiff() =>
    TimeFrame=Hourly*60
    yesterday =security(tickerid, tostring(TimeFrame), hlc3[1], false)
    today_open =security(tickerid, tostring(TimeFrame), open, false)
    today_high =security(tickerid, tostring(TimeFrame), high, false)
    today_low =security(tickerid, tostring(TimeFrame), low, false)
    today = (today_open + today_high + today_low )/3
    percentage=((today-yesterday)/yesterday)*100
    
closeDiff = getDiff()
threshold = ema(closeDiff, 50) * thresholdLimit
buying = closeDiff > threshold ? true : closeDiff < -threshold ? false : buying[1]
//buying = closeDiff[0] > closeDiff[1] ? true : closeDiff[0] < closeDiff[1] ? false : buying[1]

plotcolor = buying ? blue : red 
hline(0, color=color(black,90) , linewidth=2,  title="zero line")
bgcolor(plotcolor, transp=85 )
plot(closeDiff, color=plotcolor, linewidth=2, title="Price Differential")
plot(threshold, color=color(teal,80) , linewidth=2,  title="Threshold High")
plot((-1*threshold), color=color(teal,80) , linewidth=2,  title="Threshold High")

if (buying)
    strategy.entry("Long", strategy.long)

if (buying != true)
    strategy.entry("Short", strategy.short)
